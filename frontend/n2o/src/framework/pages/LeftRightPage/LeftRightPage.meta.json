{
  "id": "proto",
  "src": "LeftRightPage",
  "width": {
    "left": "69%",
    "right": "29%"
  },
  "regions": {
    "left": [
      {
        "src": "PanelRegion",
        "hasTabs": false,
        "headerTitle": "Данные пациента",
        "open": true,
        "collapsible": false,
        "fullScreen": false,
        "header": true,
        "panels": [
          {
            "id": "panel1",
            "label": "Пациенты",
            "opened": true,
            "widgetId": "proto_patients"
          }
        ]
      }
    ],
    "right": [
      {
        "src": "PanelRegion",
        "hasTabs": false,
        "headerTitle": "Контакты",
        "open": true,
        "collapsible": true,
        "fullScreen": false,
        "panels": [
          {
            "id": "panel1",
            "label": "Контакты",
            "opened": true,
            "widgetId": "proto_contacts"
          }
        ]
      },
      {
        "src": "PanelRegion",
        "hasTabs": false,
        "headerTitle": "Карточка",
        "open": true,
        "collapsible": true,
        "fullScreen": false,
        "panels": [
          {
            "id": "panel1",
            "opened": true,
            "widgetId": "proto_form"
          }
        ]
      }
    ]
  },
  "widgets": {
    "proto_patients": {
      "src": "AdvancedTableWidget",
      "dataProvider": {
        "url": "n2o/data/proto",
        "pathMapping": {},
        "queryMapping": {}
      },
      "table": {
        "fetchOnInit": true,
        "autoFocus": true,
        "size": 10,
        "hasFocus": true,
        "hasSelect": true,
        "cells": [
          {
            "id": "surname",
            "fieldKey": "surname",
            "src": "LinkCell",
            "actionId": "surname"
          },
          {
            "id": "name",
            "fieldKey": "name",
            "src": "LinkCell",
            "actionId": "name"
          },
          {
            "id": "patrName",
            "fieldKey": "patrName",
            "src": "LinkCell",
            "url": "`'/'+id+'/update2'`",
            "target": "application",
            "visible": "`name!='Мария'`"
          },
          {
            "id": "birthday",
            "fieldKey": "birthday",
            "src": "EditableCell",
            "actionId": "update_birthday",
            "control": {
              "src": "DatePicker",
              "id": "birthday",
              "dateFormat": "DD.MM.YYYY",
              "utc": false,
              "outputFormat": "YYYY-MM-DDTHH:mm:ss"
            },
            "format": "date DD.MM.YYYY",
            "editFieldId": "birthday",
            "editType": "inline",
            "editable": true
          },
          {
            "id": "genderName",
            "fieldKey": "genderName",
            "src": "BadgeCell",
            "color": "`gender.id==1?'danger':'success'`"
          },
          {
            "id": "vip",
            "fieldKey": "vip",
            "src": "CheckboxCell",
            "actionId": "vip",
            "disabled": "`!(name!='Мария')`"
          },
          {
            "id": "",
            "fieldKey": "",
            "src": "ButtonsCell",
            "buttons": [
              {
                "id": "subMenu0",
                "icon": "fa fa-ellipsis-v",
                "conditions": {},
                "subMenu": [
                  {
                    "id": "delete",
                    "icon": "fa fa-trash",
                    "actionId": "delete",
                    "conditions": {
                      "enabled": [
                        {
                          "expression": "!_.isEmpty(this)",
                          "modelLink": "models.resolve['proto_patients']"
                        }
                      ]
                    },
                    "confirm": {
                      "text": "`'Вы уверены, что хотите удалить пациента ' + this.surname + ' ' + this.name + '?'`",
                      "title": "Предупреждение",
                      "okLabel": "Да",
                      "cancelLabel": "Нет",
                      "modelLink": "models.resolve['proto_patients']"
                    },
                    "title": "Удалить"
                  },
                  {
                    "id": "update",
                    "icon": "fa fa-pencil",
                    "actionId": "update",
                    "conditions": {
                      "enabled": [
                        {
                          "expression": "!_.isEmpty(this)",
                          "modelLink": "models.resolve['proto_patients']"
                        }
                      ]
                    },
                    "title": "Изменить"
                  }
                ]
              }
            ]
          }
        ],
        "headers": [
          {
            "id": "surname",
            "label": "Фамилия",
            "src": "TextTableHeader",
            "sortable": true
          },
          {
            "id": "name",
            "label": "Имя",
            "src": "TextTableHeader",
            "sortable": true
          },
          {
            "id": "patrName",
            "label": "Отчество",
            "src": "TextTableHeader",
            "sortable": true
          },
          {
            "id": "birthday",
            "label": "Дата рождения",
            "src": "TextTableHeader",
            "sortable": true
          },
          {
            "id": "genderName",
            "label": "Пол",
            "src": "TextTableHeader",
            "sortable": false
          },
          {
            "id": "vip",
            "label": "VIP",
            "src": "TextTableHeader",
            "sortable": false
          },
          {
            "id": "",
            "src": "TextTableHeader"
          }
        ],
        "sorting": {
          "birthday": "ASC"
        }
      }
    },
    "proto_contacts": {
      "src": "ListWidget",
      "dataProvider": {
        "url": "n2o/data/proto/:proto_patients_id/contacts",
        "pathMapping": {
          "proto_patients_id": {
            "link": "models.resolve['proto_patients'].id"
          }
        },
        "queryMapping": {}
      },
      "toolbar": {
        "topLeft": [
          {
            "id": "topLeft0",
            "buttons": [
              {
                "id": "create",
                "icon": "fa fa-plus",
                "actionId": "create",
                "conditions": {},
                "title": "Создать"
              }
            ]
          }
        ]
      },
      "dependency": {
        "fetch": [
          {
            "on": "models.resolve['proto_patients']"
          }
        ],
        "visible": [
          {
            "on": "models.resolve['proto_patients']",
            "condition": "name != 'Мария'"
          }
        ]
      },
      "list": {
        "leftTop": {
          "src": "IconCell",
          "icon": "`type.id == 2 ? 'fa fa-phone' : type.id == 4 ? 'fa fa-envelop' : type.id == 7 ? 'fa fa-fax' : null`"
        },
        "extra": {
          "src": "ButtonsCell",
          "buttons": [
            {
              "id": "update",
              "icon": "fa fa-pencil",
              "actionId": "update",
              "conditions": {
                "enabled": [
                  {
                    "expression": "!_.isEmpty(this)",
                    "modelLink": "models.resolve['proto_contacts']"
                  }
                ]
              },
              "title": "Изменить"
            },
            {
              "id": "delete",
              "icon": "fa fa-trash",
              "actionId": "delete",
              "conditions": {
                "enabled": [
                  {
                    "expression": "!_.isEmpty(this)",
                    "modelLink": "models.resolve['proto_contacts']"
                  }
                ]
              },
              "confirm": {
                "text": "Нажмите \"Да\", если Вы уверены в совершаемом действии. Или \"Нет\", если ещё хотите обдумать совершаемое действие.",
                "title": "Предупреждение",
                "okLabel": "Да",
                "cancelLabel": "Нет"
              },
              "title": "Удалить"
            }
          ]
        },
        "header": {
          "id": "type.name",
          "fieldKey": "type.name",
          "src": "TextCell",
          "className": "text-muted"
        },
        "body": {
          "id": "value",
          "fieldKey": "value",
          "src": "TextCell"
        }
      },
      "paging": {
        "size": 5
      }
    },
    "proto_form": {
      "src": "FormWidget",
      "dataProvider": {
        "url": "n2o/data/proto/:patient_id/card",
        "pathMapping": {
          "patient_id": {
            "link": "models.resolve['proto_patients'].id"
          }
        },
        "queryMapping": {}
      },
      "actions": {},
      "dependency": {
        "fetch": [
          {
            "on": "models.resolve['proto_patients']"
          }
        ]
      },
      "form": {
        "fieldsets": [
          {
            "src": "StandardFieldset",
            "rows": [
              {
                "cols": [
                  {
                    "fields": [
                      {
                        "src": "StandardField",
                        "id": "surname",
                        "label": "Фамилия",
                        "dependency": [],
                        "control": {
                          "src": "InputText",
                          "id": "surname"
                        }
                      }
                    ]
                  },
                  {
                    "fields": [
                      {
                        "src": "StandardField",
                        "id": "name",
                        "label": "Имя",
                        "dependency": [],
                        "control": {
                          "src": "InputText",
                          "id": "name"
                        }
                      }
                    ]
                  }
                ]
              },
              {
                "cols": [
                  {
                    "size": 8,
                    "fields": [
                      {
                        "src": "StandardField",
                        "id": "gender",
                        "enabled": false,
                        "label": "Пол",
                        "dependency": [],
                        "control": {
                          "src": "RadioGroup",
                          "id": "gender",
                          "valueFieldId": "id",
                          "labelFieldId": "name",
                          "size": 30,
                          "dataProvider": {
                            "url": "n2o/data/ProtoGender",
                            "queryMapping": {}
                          },
                          "type": "n2o"
                        }
                      }
                    ]
                  },
                  {
                    "fields": [
                      {
                        "src": "StandardField",
                        "id": "vip",
                        "enabled": false,
                        "dependency": [],
                        "control": {
                          "src": "Checkbox",
                          "id": "vip",
                          "label": "VIP"
                        }
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ],
        "validation": {},
        "modelPrefix": "resolve",
        "fetchOnInit": false,
        "autoFocus": true
      }
    }
  },
  "models": {
    "filter['proto_patients'].genders": {
      "link": "models.filter['proto_patients'].genders"
    }
  }
}